<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VerseCurator Phase 3.5 ‚Äì Core Bible Experience (MVP)</title>

  <!-- PWA Manifest & Icons (from dev17) -->
  <link rel="manifest" href="https://mashifmj-prog.github.io/VerseCurator-dev17/manifest.json" />
  <link rel="icon" href="https://mashifmj-prog.github.io/VerseCurator-dev17/favicon.ico" />
  <meta name="theme-color" content="#1a1a2e" />

  <!-- Core Styles: Modern UI + Dark Mode (dev17 foundation) -->
  <link rel="stylesheet" href="https://mashifmj-prog.github.io/VerseCurator-dev17/css/style.css" />
  <style>
    /* Inline enhancements to bridge gaps */
    :root {
      --primary: #4a90e2;
      --bg-light: #f8f9fa;
      --bg-dark: #16213e;
      --text-light: #333;
      --text-dark: #e0e0e0;
    }
    body { margin:0; font-family: 'Segoe UI', sans-serif; background: var(--bg-dark); color: var(--text-dark); }
    .app { max-width: 1200px; margin: auto; padding: 1rem; }
    .nav { display: flex; justify-content: space-around; background: rgba(0,0,0,0.3); padding: 1rem; position: sticky; top:0; z-index:100; }
    .nav a { color: white; text-decoration: none; font-weight: 600; }
    .reader { display: grid; grid-template-columns: 1fr 300px; gap: 1.5rem; margin-top: 1rem; }
    .verse-text { line-height: 1.8; font-size: 1.1rem; }
    .verse { margin-bottom: 0.5rem; }
    .verse-num { font-weight: bold; color: var(--primary); margin-right: 0.3rem; }
    .highlight { background: rgba(255,215,0,0.3); padding: 0 4px; border-radius: 3px; }
    .notes-panel { background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px; }
    .quick-actions { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 0.5rem; }
    .fab { width: 50px; height: 50px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.3); font-size: 1.2rem; cursor: pointer; }
    @media (max-width: 768px) { .reader { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

  <div class="app">
    <!-- Primary Navigation (Always Visible) -->
    <nav class="nav">
      <a href="#home">Home</a>
      <a href="#read">Read</a>
      <a href="#discover">Discover</a>
      <a href="#community">Community</a>
      <a href="#profile">Profile</a>
    </nav>

    <!-- Main Reader View (Core MVP from dev10 logic + dev17 PWA) -->
    <section id="read" class="reader">
      <div class="verse-content">
        <h2 id="chapter-title">Genesis 1 (KJV)</h2>
        <div id="verses" class="verse-text">
          <!-- Bible text loaded from public domain KJV via dev10 structure -->
          <div class="verse"><span class="verse-num">1</span>In the beginning God created the heaven and the earth.</div>
          <div class="verse"><span class="verse-num">2</span>And the earth was without form, and void; and darkness <i>was</i> upon the face of the deep. And the Spirit of God moved upon the face of the waters.</div>
          <div class="verse highlight"><span class="verse-num">3</span>And God said, Let there be light: and there was light.</div>
          <!-- ... more verses ... -->
        </div>

        <!-- Book/Chapter Navigation (dev10 style) -->
        <div style="margin: 1.5rem 0; display: flex; justify-content: space-between;">
          <button onclick="prevChapter()">‚Üê Previous</button>
          <select id="book-select" onchange="changeBook()"></select>
          <select id="chapter-select" onchange="changeChapter()"></select>
          <button onclick="nextChapter()">Next ‚Üí</button>
        </div>
      </div>

      <!-- Notes & Highlights Panel (Phase 1.2) -->
      <aside class="notes-panel">
        <h3>Notes & Highlights</h3>
        <div id="user-notes">
          <p><strong>Gen 1:3</strong> ‚Äì <em>First divine command. Light = revelation.</em> <small>(You, 2h ago)</small></p>
        </div>
        <textarea id="quick-note" placeholder="Add note to selected verse..." style="width:100%; margin-top:0.5rem;"></textarea>
        <button style="margin-top:0.5rem; background:var(--primary); color:white; border:none; padding:0.5rem 1rem; border-radius:4px;">Save Note</button>
      </aside>
    </section>
  </div>

  <!-- Quick Actions (Floating) -->
  <div class="quick-actions">
    <div class="fab" onclick="toggleSearch()">üîç</div>
    <div class="fab" onclick="addQuickNote()">üìù</div>
    <div class="fab" onclick="toggleTheme()">üåô</div>
    <div class="fab" onclick="shareVerse()">üë•</div>
  </div>

  <!-- Scripts: Merge dev10 core logic + dev17 PWA/service worker -->
  <script>
    // === dev10 Core Reading Engine (simplified) ===
    const books = [
      { name: "Genesis", chapters: 50 },
      { name: "Exodus", chapters: 40 },
      // ... full list
    ];

    function initBibleNav() {
      const bookSel = document.getElementById('book-select');
      books.forEach((b, i) => {
        const opt = document.createElement('option');
        opt.value = i; opt.textContent = b.name;
        bookSel.appendChild(opt);
      });
      updateChapterSelect();
    }

    function updateChapterSelect() {
      const bookIdx = document.getElementById('book-select').value;
      const chapSel = document.getElementById('chapter-select');
      chapSel.innerHTML = '';
      for (let i = 1; i <= books[bookIdx].chapters; i++) {
        const opt = document.createElement('option');
        opt.value = i; opt.textContent = `Chapter ${i}`;
        chapSel.appendChild(opt);
      }
    }

    function changeBook() { updateChapterSelect(); loadChapter(); }
    function changeChapter() { loadChapter(); }
    function prevChapter() { /* logic */ }
    function nextChapter() { /* logic */ }

    async function loadChapter() {
      const book = books[document.getElementById('book-select').value].name;
      const chap = document.getElementById('chapter-select').value;
      document.getElementById('chapter-title').textContent = `${book} ${chap} (KJV)`;

      // Simulate fetching from public domain KJV JSON (cached via dev17 PWA)
      const response = await fetch(`https://raw.githubusercontent.com/mashifmj-prog/bible-kjv-json/main/${book}/${chap}.json`);
      const data = await response.json();
      const versesDiv = document.getElementById('verses');
      versesDiv.innerHTML = data.verses.map(v => 
        `<div class="verse"><span class="verse-num">${v.verse}</span>${v.text}</div>`
      ).join('');
    }

    // === dev17 PWA Enhancements ===
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('https://mashifmj-prog.github.io/VerseCurator-dev17/sw.js')
          .then(reg => console.log('SW registered', reg))
          .catch(err => console.log('SW failed', err));
      });
    }

    // === Phase 1 Features: Highlights, Notes, Search, Theme ===
    let selectedVerse = null;
    document.addEventListener('click', e => {
      if (e.target.closest('.verse')) {
        const verse = e.target.closest('.verse');
        verse.classList.toggle('highlight');
        selectedVerse = verse.querySelector('.verse-num').textContent;
      }
    });

    function addQuickNote() {
      if (!selectedVerse) return alert("Select a verse first");
      const note = prompt("Your note:", "");
      if (note) {
        const notesDiv = document.getElementById('user-notes');
        notesDiv.innerHTML += `<p><strong>Gen 1:${selectedVerse}</strong> ‚Äì <em>${note}</em> <small>(You, now)</small></p>`;
      }
    }

    function toggleSearch() {
      const query = prompt("Search Scripture:");
      if (query) alert(`Searching: "${query}" (semantic search coming in Phase 2)`);
    }

    function toggleTheme() {
      document.body.classList.toggle('light');
      // Persist via localStorage + sync with dev17 PWA
    }

    function shareVerse() {
      if (!selectedVerse) return alert("Select a verse");
      const text = document.querySelector(`.verse-num:contains(${selectedVerse})`).nextSibling.textContent;
      navigator.share?.({ title: "VerseCurator", text: `Gen 1:${selectedVerse} ‚Äì ${text}` });
    }

    // Init
    initBibleNav();
    loadChapter();
  </script>

  <!-- Offline Fallback (dev17) -->
  <noscript>
    <p style="text-align:center; padding:2rem; color:#aaa;">
      JavaScript is required for VerseCurator. Please enable it or use a modern browser.
    </p>
  </noscript>
</body>
</html>
